<!DOCTYPE html>
<html lang="ja">
<head>
  <base target="_top">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>å¤§äººå¥³å­ã®ã€ã”è¤’ç¾ã‚»ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³</title>
  
  <link rel="icon" href="favicon.png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  
  <style>
    :root {
      --main-color: #f7a8b8;
      --accent-color: #d4a373;
      --text-color: #4a4242;
      --bg-color: #fff9f9;
      --gold: #d4af37;
    }

    body { background-color: var(--bg-color); padding: 15px; font-family: 'Noto Sans JP', sans-serif; color: var(--text-color); }
    .container { max-width: 500px; margin: auto; }
    
    .card-main {
      border-radius: 35px; border: none; box-shadow: 0 10px 30px rgba(247,168,184,0.15);
      background: #ffffff; padding: 35px 25px; margin-top: 15px;
    }

    .header-icon-box {
      width: 80px; height: 80px; background: linear-gradient(135deg, #fff0f3, #ffe0e6);
      border-radius: 50%; display: flex; align-items: center; justify-content: center;
      margin: 0 auto 20px; color: var(--main-color); font-size: 2.2rem;
    }

    .form-select { border-radius: 15px; border: 2px solid #fff0f3; padding: 12px; margin-bottom: 20px; }

    .btn-diagnosis {
      background: linear-gradient(135deg, var(--main-color), var(--accent-color));
      color: white; border: none; border-radius: 50px; font-weight: 700; padding: 18px; width: 100%;
      box-shadow: 0 8px 20px rgba(247, 168, 184, 0.4); transition: 0.3s;
    }

    .analysis-box {
      background: #fff0f3; padding: 20px; border-radius: 20px; margin: 30px 0;
      border-left: 6px solid var(--main-color); font-size: 0.85rem; line-height: 1.7;
    }

    .product-card {
      border-radius: 22px; border: 1px solid #fff0f3; 
      margin-bottom: 25px; background: white; overflow: hidden; display: flex; flex-direction: column;
    }
    
    .img-wrapper { width: 100%; height: 220px; display: flex; align-items: center; justify-content: center; padding: 10px; }
    .product-img { max-width: 100%; max-height: 100%; object-fit: contain; }
    .product-content { padding: 20px; }

    .ai-badge { background: #ffb7c5; color: white; font-size: 0.65rem; padding: 4px 14px; border-radius: 20px; font-weight: bold; margin-bottom: 10px; display: inline-block; }
    .price-tag { color: var(--main-color); font-weight: bold; font-size: 1.1rem; }
    .btn-detail { background-color: var(--main-color); color: white; border-radius: 25px; padding: 8px 25px; text-decoration: none; font-size: 0.85rem; font-weight: bold; border: none; }

    /* ç©¶æ¥µã®ä¸€å“ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .ultimate-section {
      background: linear-gradient(135deg, #fffdf3, #fff5e6);
      border: 2px solid var(--gold); border-radius: 30px; position: relative;
    }
    .ultimate-card { border: 3px solid var(--gold) !important; box-shadow: 0 15px 35px rgba(212, 175, 55, 0.2) !important; }

    #loading { display: none; text-align: center; padding: 30px; }
  </style>
</head>
<body>
  <div class="container text-center">
    <div class="card-main">
      <div class="header-icon-box shadow-sm"><i class="fas fa-gift"></i></div>
      <h4 class="fw-bold">å¤§äººå¥³å­ã®ã€ã”è¤’ç¾ã‚»ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³</h4>
      <p class="small text-muted mb-4">AIã‚³ãƒ³ã‚·ã‚§ãƒ«ã‚¸ãƒ¥ãŒææ¡ˆã™ã‚‹<br>ä»Šã®ã‚ãªãŸã«ã´ã£ãŸã‚Šã®é€¸å“</p>

      <form id="searchForm" class="text-start">
        <label class="small fw-bold mb-2">æ€§åˆ¥ & å¹´ä»£</label>
        <div class="row g-2 mb-3">
          <div class="col-6"><select class="form-select" id="gender"><option value="å¥³æ€§" selected>å¥³æ€§</option><option value="ç”·æ€§">ç”·æ€§</option></select></div>
          <div class="col-6"><select class="form-select" id="age"><option value="20ä»£">20ä»£</option><option value="30ä»£">30ä»£</option><option value="40ä»£" selected>40ä»£</option><option value="50ä»£">50ä»£</option></select></div>
        </div>
        <label class="small fw-bold mb-2">æ€§æ ¼ã‚¿ã‚¤ãƒ— (MBTI)</label>
        <select class="form-select" id="mbti">
          <optgroup label="åˆ†æå®¶"><option value="INTJ">INTJ</option><option value="INTP">INTP</option><option value="ENTJ">ENTJ</option><option value="ENTP">ENTP</option></optgroup>
          <optgroup label="å¤–äº¤å®˜"><option value="INFJ">INFJ</option><option value="INFP">INFP</option><option value="ENFJ">ENFJ</option><option value="ENFP">ENFP</option></optgroup>
          <optgroup label="ç•ªäºº"><option value="ISTJ">ISTJ</option><option value="ISFJ">ISFJ</option><option value="ESTJ">ESTJ</option><option value="ESFJ">ESFJ</option></optgroup>
          <optgroup label="æ¢æ¤œå®¶"><option value="ISTP">ISTP</option><option value="ISFP">ISFP</option><option value="ESTP">ESTP</option><option value="ESFP">ESFP</option></optgroup>
        </select>
        <button type="button" class="btn-diagnosis" onclick="submitForm()">ã“ã®å†…å®¹ã§è¨ºæ–­ã™ã‚‹</button>
      </form>

      <div id="loading"><div class="spinner-border text-pink"></div><p class="mt-3 small">ã‚³ãƒ³ã‚·ã‚§ãƒ«ã‚¸ãƒ¥ãŒå³é¸ä¸­...</p></div>
      <div id="results" class="mt-4 text-start"></div>
    </div>
  </div>

  <script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbxDaf3ladih274DwfUcgqQX-0-P-w0W_1zmREAicx-ILpyFqawerpEEgWdnTIH9Ghza/exec";

    async function submitForm() {
      document.getElementById('loading').style.display = 'block';
      document.getElementById('results').innerHTML = '';
      const payload = { gender: document.getElementById('gender').value, age: document.getElementById('age').value, mbti: document.getElementById('mbti').value };
      try {
        const response = await fetch(GAS_URL, { method: 'POST', body: JSON.stringify(payload) });
        const data = await response.json();
        showResults(data);
      } catch (e) { alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚"); document.getElementById('loading').style.display = 'none'; }
    }

    function showResults(data) {
      document.getElementById('loading').style.display = 'none';
      let html = '';
      if (data.analysis) html += `<div class="analysis-box"><strong>Message:</strong><br>${data.analysis}</div>`;
      
      for (let cat in data.items) {
        html += `<h6 class="text-center my-4 fw-bold">- ${cat} -</h6>`;
        data.items[cat].forEach(item => {
          html += `<div class="product-card shadow-sm"><div class="img-wrapper"><img src="${item.image}" class="product-img"></div><div class="product-content"><div class="ai-badge">${item.aiComment}</div><h6 class="small fw-bold">${item.name}</h6><div class="d-flex justify-content-between align-items-center mt-3"><span class="price-tag">${item.price}</span><a href="${item.url}" target="_blank" class="btn-detail">è©³ç´°</a></div></div></div>`;
        });
      }

      if (data.ultimateItem) {
        html += `<div class="ultimate-section mt-5 p-4"><h5 class="text-center fw-bold mb-3" style="color:var(--gold)">ğŸ‘‘ ç©¶æ¥µã®é¸æŠ</h5><div class="product-card ultimate-card"><div class="img-wrapper"><img src="${data.ultimateItem.image}" class="product-img"></div><div class="product-content"><p class="fst-italic small mb-3">"${data.ultimateItem.ultimateReason}"</p><h6 class="fw-bold">${data.ultimateItem.name}</h6><div class="d-flex justify-content-between align-items-center mt-3"><span class="price-tag">${data.ultimateItem.price}</span><a href="${data.ultimateItem.url}" target="_blank" class="btn-detail" style="background:var(--gold)">ä»Šã™ããƒã‚§ãƒƒã‚¯</a></div></div></div></div>`;
      }
      document.getElementById('results').innerHTML = html;
      document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
    }
  </script>
</body>
</html>
