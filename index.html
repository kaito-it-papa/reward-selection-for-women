<!DOCTYPE html>
<html lang="ja">
<head>
  <base target="_top">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>å¤§äººå¥³å­ã®ã€ã”è¤’ç¾ã‚»ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³</title>
  
  <link rel="icon" href="favicon.png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  
  <style>
    :root {
      --main-color: #f7a8b8;
      --accent-color: #d4a373;
      --text-color: #4a4242;
      --bg-color: #fff9f9;
      --gold: #d4af37;
    }

    body { background-color: var(--bg-color); padding: 15px; font-family: 'Noto Sans JP', sans-serif; color: var(--text-color); }
    .container { max-width: 500px; margin: auto; }
    
    .card-main {
      border-radius: 35px; border: none; box-shadow: 0 10px 30px rgba(247,168,184,0.15);
      background: #ffffff; padding: 35px 25px; margin-top: 15px;
    }

    .header-icon-box {
      width: 80px; height: 80px; background: linear-gradient(135deg, #fff0f3, #ffe0e6);
      border-radius: 50%; display: flex; align-items: center; justify-content: center;
      margin: 0 auto 20px; color: var(--main-color); font-size: 2.2rem;
    }

    .form-select { border-radius: 15px; border: 2px solid #fff0f3; padding: 12px; margin-bottom: 20px; font-size: 0.9rem; }

    .btn-diagnosis {
      background: linear-gradient(135deg, var(--main-color), var(--accent-color));
      color: white; border: none; border-radius: 50px; font-weight: 700; padding: 18px; width: 100%;
      box-shadow: 0 8px 20px rgba(247, 168, 184, 0.4); transition: 0.3s;
    }

    .analysis-box {
      background: #fff0f3; padding: 20px; border-radius: 20px; margin: 30px 0;
      border-left: 6px solid var(--main-color); font-size: 0.85rem; line-height: 1.7;
    }

    .product-card {
      border-radius: 22px; border: 1px solid #fff0f3; 
      margin-bottom: 25px; background: white; overflow: hidden; display: flex; flex-direction: column;
    }
    
    .img-wrapper { width: 100%; height: 220px; display: flex; align-items: center; justify-content: center; padding: 10px; }
    .product-img { max-width: 100%; max-height: 100%; object-fit: contain; }
    .product-content { padding: 20px; }

    .ai-badge { background: #ffb7c5; color: white; font-size: 0.65rem; padding: 4px 14px; border-radius: 20px; font-weight: bold; margin-bottom: 10px; display: inline-block; }
    .tag-shipping { background:#fff0f3; color:#f06595; border:1px solid #f06595; font-size:0.6rem; padding:2px 6px; border-radius:4px; margin-right:5px; font-weight:bold; }
    .tag-deal { background:#fff9db; color:#d9480f; border:1px solid #d9480f; font-size:0.6rem; padding:2px 6px; border-radius:4px; margin-right:5px; font-weight:bold; }
    .tag-rating { color:#d4a373; font-size:0.75rem; font-weight:bold; }

    .price-tag { color: var(--main-color); font-weight: bold; font-size: 1.1rem; }
    .btn-detail { background-color: var(--main-color); color: white; border-radius: 25px; padding: 8px 25px; text-decoration: none; font-size: 0.85rem; font-weight: bold; border: none; display: inline-block; }

    .ultimate-section { background: linear-gradient(135deg, #fffdf3, #fff5e6); border: 2px solid var(--gold); border-radius: 30px; }
    .ultimate-card { border: 3px solid var(--gold) !important; box-shadow: 0 15px 35px rgba(212, 175, 55, 0.2) !important; }

    #loading { display: none; text-align: center; padding: 30px; }
    .disclaimer { margin-top: 50px; padding: 25px; border-radius: 20px; background: #fafafa; font-size: 0.75rem; color: #999; text-align: center; }
  </style>
</head>
<body>
  <div class="container text-center">
    <div class="card-main">
      <div class="header-icon-box shadow-sm"><i class="fas fa-gift"></i></div>
      <h4 class="fw-bold">å¤§äººå¥³å­ã®ã€ã”è¤’ç¾ã‚»ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³</h4>
      <p class="small text-muted mb-4">AIã‚³ãƒ³ã‚·ã‚§ãƒ«ã‚¸ãƒ¥ãŒææ¡ˆã™ã‚‹<br>ä»Šã®ã‚ãªãŸã«ã´ã£ãŸã‚Šã®é€¸å“</p>

      <form id="searchForm" class="text-start">
        <label class="small fw-bold mb-2">æ€§åˆ¥ & å¹´ä»£</label>
        <div class="row g-2 mb-3">
          <div class="col-6"><select class="form-select" id="gender"><option value="å¥³æ€§" selected>å¥³æ€§</option><option value="ç”·æ€§">ç”·æ€§</option></select></div>
          <div class="col-6"><select class="form-select" id="age"><option value="20ä»£">20ä»£</option><option value="30ä»£">30ä»£</option><option value="40ä»£" selected>40ä»£</option><option value="50ä»£">50ä»£</option><option value="60ä»£">60ä»£</option></select></div>
        </div>
        <label class="small fw-bold mb-2">æ€§æ ¼ã‚¿ã‚¤ãƒ— (MBTI)</label>
        <select class="form-select" id="mbti">
          <optgroup label="åˆ†æå®¶"><option value="INTJ">INTJ</option><option value="INTP">INTP</option><option value="ENTJ">ENTJ</option><option value="ENTP">ENTP</option></optgroup>
          <optgroup label="å¤–äº¤å®˜"><option value="INFJ">INFJ</option><option value="INFP">INFP</option><option value="ENFJ">ENFJ</option><option value="ENFP">ENFP</option></optgroup>
          <optgroup label="ç•ªäºº"><option value="ISTJ">ISTJ</option><option value="ISFJ">ISFJ</option><option value="ESTJ">ESTJ</option><option value="ESFJ">ESFJ</option></optgroup>
          <optgroup label="æ¢æ¤œå®¶"><option value="ISTP">ISTP</option><option value="ISFP">ISFP</option><option value="ESTP">ESTP</option><option value="ESFP">ESFP</option></optgroup>
        </select>
        <button type="button" class="btn-diagnosis" onclick="submitForm()">ã“ã®å†…å®¹ã§è¨ºæ–­ã™ã‚‹</button>
      </form>

      <div id="loading"><div class="spinner-border" style="color:var(--main-color)"></div><p class="mt-3 small">ã‚³ãƒ³ã‚·ã‚§ãƒ«ã‚¸ãƒ¥ãŒå³é¸ä¸­...</p></div>
      <div id="results" class="mt-4 text-start"></div>

      <div class="disclaimer shadow-sm">
        <i class="fas fa-info-circle mb-2"></i><br>
        â€»å½“ã‚µã‚¤ãƒˆã¯æ¥½å¤©ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«å‚åŠ ã—ã¦ãŠã‚Šã€ç´¹ä»‹ã—ãŸå•†å“ã‹ã‚‰åç›Šã‚’å¾—ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
      </div>
    </div>
  </div>

  <script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbxDaf3ladih274DwfUcgqQX-0-P-w0W_1zmREAicx-ILpyFqawerpEEgWdnTIH9Ghza/exec";

    async function submitForm() {
      const loading = document.getElementById('loading');
      const results = document.getElementById('results');
      loading.style.display = 'block';
      results.innerHTML = '';
      
      const payload = { 
        gender: document.getElementById('gender').value, 
        age: document.getElementById('age').value, 
        mbti: document.getElementById('mbti').value 
      };

      try {
        const response = await fetch(GAS_URL, { method: 'POST', body: JSON.stringify(payload) });
        const data = await response.json();
        showResults(data);
      } catch (e) { 
        alert("é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚"); 
        loading.style.display = 'none'; 
      }
    }

    function showResults(data) {
      document.getElementById('loading').style.display = 'none';
      let resultsDiv = document.getElementById('results');
      let html = '';

      if (data.error) {
        resultsDiv.innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
        return;
      }

      if (data.analysis) html += `<div class="analysis-box"><strong>Concierge Message</strong><br>${data.analysis}</div>`;
      
      const itemsMap = data.items || {};
      Object.keys(itemsMap).forEach(catName => {
        const productList = itemsMap[catName];
        if (!Array.isArray(productList)) return;

        html += `<h6 class="text-center my-4 fw-bold" style="color:#8d7e7e">- ${catName} -</h6>`;
        productList.forEach(item => {
          let badges = '';
          if (item.isFreeShipping) badges += `<span class="tag-shipping">é€æ–™ç„¡æ–™</span>`;
          if (item.isSuperDeal) badges += `<span class="tag-deal">DEALå¯¾è±¡</span>`;
          if (item.reviewAverage) badges += `<span class="tag-rating">â­ ${item.reviewAverage}</span>`;

          html += `
            <div class="product-card shadow-sm">
              <div class="img-wrapper"><img src="${item.image}" class="product-img"></div>
              <div class="product-content">
                <div class="ai-badge">${item.aiComment}</div>
                <div class="mb-2">${badges}</div>
                <h6 class="fw-bold mb-3" style="font-size:0.85rem; line-height:1.5">${item.name}</h6>
                <div class="d-flex justify-content-between align-items-center mt-3">
                  <span class="price-tag">${item.price}</span>
                  <a href="${item.url}" target="_blank" class="btn-detail">è©³ç´°ã‚’è¦‹ã‚‹</a>
                </div>
              </div>
            </div>`;
        });
      });

      if (data.ultimateItem) {
        const u = data.ultimateItem;
        let uBadges = '';
        if (u.isFreeShipping) uBadges += `<span class="tag-shipping" style="background:var(--gold); border-color:var(--gold); color:white;">é€æ–™ç„¡æ–™</span>`;
        if (u.isSuperDeal) uBadges += `<span class="tag-deal">DEALå¯¾è±¡</span>`;

        html += `
          <div class="ultimate-section mt-5 p-4 text-center">
            <h5 class="fw-bold mb-3" style="color:var(--gold)">ğŸ‘‘ ç©¶æ¥µã®é¸æŠ</h5>
            <div class="product-card ultimate-card">
              <div class="img-wrapper"><img src="${u.image}" class="product-img"></div>
              <div class="product-content text-start">
                <div class="mb-2">
                  ${uBadges}
                  <span class="tag-rating" style="color:var(--gold)">â­ ${u.reviewAverage}</span>
                </div>
                <p class="fst-italic small mb-3" style="color:#666">"${u.ultimateReason}"</p>
                <h6 class="fw-bold mb-3">${u.name}</h6>
                <div class="d-flex justify-content-between align-items-center">
                  <span class="price-tag">${u.price}</span>
                  <a href="${u.url}" target="_blank" class="btn btn-detail" style="background:var(--gold)">ä»Šã™ãæ‰‹ã«å…¥ã‚Œã‚‹</a>
                </div>
              </div>
            </div>
          </div>`;
      }
      
      resultsDiv.innerHTML = html;
      resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  </script>
</body>
</html>
